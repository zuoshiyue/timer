# 训练间隔计时器APP - 安装说明和调试指南

## 项目概述

这是一个功能完整的Android训练间隔计时器应用，具有以下核心功能：

- ✅ **训练计划管理** - 创建、编辑、删除多阶段训练计划
- ✅ **计时器功能** - 支持热身、训练、休息、冷身等多阶段计时
- ✅ **声音震动提醒** - 可配置的声音和震动提醒系统
- ✅ **训练记录** - 自动记录训练历史并支持统计查看
- ✅ **设置系统** - 完整的用户设置界面

## 环境要求

### 开发环境
- Android Studio 2022.3.1 或更高版本
- Android SDK 33
- Java 8
- Kotlin 1.8.0

### 目标设备
- Android 8.0 (API 26) 或更高版本
- 支持震动和音频播放的Android设备

## 安装步骤

### 方法一：通过Android Studio运行

1. **打开项目**
   ```bash
   # 在Android Studio中选择 File > Open
   # 选择项目根目录 /Users/lpf/Documents/docker/timer
   ```

2. **同步Gradle项目**
   - Android Studio会自动检测并同步Gradle依赖
   - 如果遇到问题，选择 File > Sync Project with Gradle Files

3. **连接设备或启动模拟器**
   - 连接Android设备并启用USB调试
   - 或启动Android模拟器（推荐使用Pixel系列）

4. **运行应用**
   - 点击 Run > Run 'app'
   - 或使用快捷键 Shift + F10

### 方法二：使用Gradle命令行构建

1. **确保已安装Android SDK和Gradle**
   ```bash
   # 检查Android SDK路径
   echo $ANDROID_HOME
   
   # 检查Gradle版本
   gradle --version
   ```

2. **构建APK**
   ```bash
   cd /Users/lpf/Documents/docker/timer
   ./gradlew assembleDebug
   ```

3. **安装到设备**
   ```bash
   ./gradlew installDebug
   ```

## 功能测试指南

### 1. 训练计划管理测试

**测试步骤：**
1. 启动应用，进入"训练计划"页面
2. 点击"+"按钮创建新计划
3. 测试单阶段和多阶段计划创建
4. 编辑现有计划并保存
5. 删除不需要的计划

**预期结果：**
- 计划列表正确显示
- 创建/编辑/删除操作无错误
- 多阶段计划设置界面正常

### 2. 计时器功能测试

**测试步骤：**
1. 选择一个训练计划
2. 点击"开始训练"进入计时器界面
3. 测试开始、暂停、重置功能
4. 观察阶段自动切换
5. 测试训练完成流程

**预期结果：**
- 计时器准确计时
- 阶段切换流畅
- 界面状态正确更新

### 3. 声音震动提醒测试

**测试步骤：**
1. 进入"设置"页面
2. 配置声音和震动设置
3. 测试不同提醒类型
4. 验证权限请求流程

**预期结果：**
- 设置保存成功
- 提醒按配置播放
- 权限处理正确

### 4. 训练记录测试

**测试步骤：**
1. 完成一次训练
2. 进入"历史记录"页面
3. 查看训练统计
4. 点击记录查看详情

**预期结果：**
- 训练记录正确保存
- 统计数据显示准确
- 详情页面信息完整

## 调试和故障排除

### 常见问题

#### 1. 构建失败
**问题：** Gradle同步失败或构建错误
**解决方案：**
- 检查网络连接
- 清理Gradle缓存：`./gradlew clean`
- 重新同步项目

#### 2. 应用崩溃
**问题：** 运行时应用崩溃
**解决方案：**
- 查看Logcat错误日志
- 检查空指针异常
- 验证资源文件完整性

#### 3. 提醒功能不工作
**问题：** 声音或震动提醒不播放
**解决方案：**
- 检查设备音量设置
- 验证权限是否授予
- 测试不同提醒类型

#### 4. 数据库操作失败
**问题：** 训练计划或记录保存失败
**解决方案：**
- 检查Room数据库配置
- 验证实体类定义
- 查看数据库错误日志

### 调试工具

#### Logcat日志
```kotlin
// 在代码中添加日志
Log.d("TimerApp", "当前状态: $currentState")
```

#### Android Profiler
- 使用Android Studio的Profiler监控性能
- 检查内存使用情况
- 分析CPU使用率

#### 单元测试
```bash
# 运行单元测试
./gradlew test

# 运行仪器化测试
./gradlew connectedAndroidTest
```

## 项目结构说明

```
app/src/main/
├── java/com/timer/workout/
│   ├── ui/                 # 用户界面
│   │   ├── fragments/      # 片段
│   │   ├── dialogs/        # 对话框
│   │   └── adapters/       # 适配器
│   ├── service/            # 服务层
│   │   ├── TimerService.kt # 计时器服务
│   │   └── ReminderManager.kt # 提醒管理器
│   ├── data/               # 数据层
│   │   ├── model/          # 数据模型
│   │   ├── dao/            # 数据访问对象
│   │   └── repository/     # 仓库层
│   ├── util/               # 工具类
│   │   ├── SettingsManager.kt
│   │   └── PermissionUtil.kt
│   └── WorkoutApplication.kt
├── res/                    # 资源文件
│   ├── layout/             # 布局文件
│   ├── drawable/           # 图标和图形
│   ├── values/             # 字符串、颜色等
│   └── raw/                # 原始资源（声音文件）
└── AndroidManifest.xml     # 应用清单
```

## 核心功能实现

### 提醒系统架构
```
SettingsFragment → SettingsManager → ReminderManager → TimerService
     ↓                ↓                  ↓              ↓
用户设置界面      设置数据管理       提醒逻辑控制     服务层集成
```

### 数据持久化
- **Room数据库**：用于训练计划和记录存储
- **SharedPreferences**：用于用户设置存储
- **LiveData**：实现数据观察和UI更新

### 权限管理
- **震动权限**：`android.permission.VIBRATE`
- **音频权限**：`android.permission.MODIFY_AUDIO_SETTINGS`
- **前台服务权限**：`android.permission.FOREGROUND_SERVICE`

## 后续开发建议

1. **功能扩展**
   - 添加训练计划导入/导出功能
   - 实现云端同步
   - 添加更多训练统计图表

2. **性能优化**
   - 实现后台计时器优化
   - 添加电池优化策略
   - 优化数据库查询性能

3. **用户体验**
   - 添加主题切换功能
   - 实现手势操作支持
   - 优化无障碍功能

## 联系和支持

如果在使用过程中遇到任何问题，请检查：

1. Android Studio的版本兼容性
2. 设备的Android版本要求
3. 必要的系统权限设置
4. 网络连接状态（用于依赖下载）

---

**文档版本：** v1.0  
**最后更新：** 2024年11月13日  
**适用版本：** 训练间隔计时器APP v1.0